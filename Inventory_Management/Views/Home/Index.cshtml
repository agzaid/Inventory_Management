@model Domain.Models.PortalVM


<style>
    .category-scroll {
        display: flex;
        overflow-x: auto;
        white-space: nowrap;
        padding: 5px;
        scrollbar-width: thin; /* For Firefox */
    }

        .category-scroll::-webkit-scrollbar {
            height: 6px; /* horizontal scrollbar height */
        }

        .category-scroll::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 3px;
        }

    .category-dropdown {
        flex: 0 0 auto; /* prevent shrinking */
    }

    #chat-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #25d366; /* WhatsApp green */
        border-radius: 50%;
        width: 55px;
        height: 55px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        #chat-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }


    /* Chat Box */
    #chat-box {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 320px;
        max-height: 420px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.25);
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 10000;
    }

    .chat-header {
        background: #28a745;
        color: white;
        padding: 10px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chat-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        background: #f9f9f9;
    }

        .chat-body .msg {
            margin: 5px 0;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 75%;
            font-size: 14px;
        }

            .chat-body .msg.bot {
                background: #e6e6e6;
                align-self: flex-start;
            }

            .chat-body .msg.user {
                background: #28a745;
                color: white;
                align-self: flex-end;
            }

    .chat-footer {
        display: flex;
        border-top: 1px solid #ddd;
    }

        .chat-footer input {
            flex: 1;
            padding: 10px;
            border: none;
            outline: none;
        }

        .chat-footer button {
            background: #28a745;
            color: white;
            border: none;
            padding: 0 15px;
            cursor: pointer;
        }

    .chat-close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #f1f1f1;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        font-size: 18px;
        font-weight: bold;
        color: #333;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .chat-close-btn:hover {
        background: #e74c3c;
        color: #fff;
        transform: rotate(90deg);
    }

    .category-scroll {
        display: flex;
        overflow-x: auto;
        padding: 10px 0;
        gap: 10px;
        scrollbar-width: thin;
    }

    .category-box {
        flex: 0 0 auto;
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 10px 18px;
        transition: all 0.2s ease;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

        .category-box:hover, .category-box.active {
            background: #f8f9fa;
            border-color: #007bff;
            color: #007bff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

    .brand-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 10px;
        border-radius: 10px;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        min-height: 100px;
    }

    .brand-card {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 8px 14px;
        font-size: 0.9rem;
        border: 1px solid #ddd;
        cursor: pointer;
        transition: all 0.2s;
    }

        .brand-card:hover {
            background: #e8f1ff;
            border-color: #007bff;
            color: #007bff;
            transform: scale(1.05);
        }

    .placeholder-text {
        color: #999;
        font-size: 0.95rem;
        margin: 0 auto;
    }

    .brand-card.active {
        background: #007bff;
        color: white;
        border-color: #0056b3;
        transform: scale(1.05);
    }

</style>

<partial name="_Hero">
    <!--end Hero -->
    <!--start feature -->
@* <partial name="_Feature"> *@
    <section id="feature" class="">
        <div class="category-dropdown mx-1 fe-box" style="cursor:pointer;">
            <h6> @Localizer["AllProducts"] </h6>
            @*   <h2>@Localizer["Greeting"]</h2>
            <h3>@Localizer["Welcome"]</h3> *@
        </div>
        <!-- CATEGORY SCROLL -->
        <div class="category-scroll mb-3">
            @foreach (var category in Model.CategoryVMs)
            {
                <div class="category-box mx-1 fe-box"
                     data-category-id="@category.Id"
                     style="cursor:pointer;">
                    <h6>@category.DisplayCategoryName</h6>
                </div>
            }
        </div>

        <!-- BRAND DISPLAY AREA -->
        <div id="brand-container" class="brand-container">
            @* <p class="placeholder-text">Select a category to view its brands</p> *@
        </div>


    </section>
    <section id="product1" class="section-p1">
        <h2>@Localizer["FeaturedProducts"]</h2>
        @* <p>Summer Collection New Modern Design</p> *@
        <div id="products-container">
            <div class="pro-container">
                <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3" id="pro-container">
                    <partial name="_ProductListPartial" model="Model.ProductVMs" />
                </div>
            </div>
        </div>
    </section>
    <section id="banner" style="height:0px" class="section-m1">
        <button class="normal" style="background-color:#088178; cursor:pointer; color: #fff;" id="exploreMore">
            @Localizer["ExploreMore"]
        </button>
    </section>

    <!-- Chat Button -->
    <div id="chat-toggle" onclick="toggleChat()">
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </div>

    <!-- Chat Box -->
    <div id="chat-box">
        <div class="chat-header">
            <span>Support Chat</span>
            <button class="chat-close-btn" onclick="toggleChat()">✕</button>

        </div>
        <div class="chat-body" id="chat-body">
            <div class="msg bot">👋 Hello! How can we help you today?</div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="Type a message..." onkeydown="if(event.key==='Enter') sendMessage()" />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

@* <section id="banner" class="section-m1">
        <h4>Repair Services</h4>
        <h2>Up to <span>70% off</span> - All t-Shirts & Accessories</h2>
        <button class="normal">Expore More</button>
    </section>

    <section id="product1" class="section-p1">
        <h2>New Arrivals</h2>
        <p>Summer Collection New Modern Design</p>
        <div class="pro-container">
            <div class="pro">
                <img src="img/products/n1.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
            <div class="pro">
                <img src="img/products/n2.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
            <div class="pro">
                <img src="img/products/n3.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
            <div class="pro">
                <img src="img/products/n4.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
            <div class="pro">
                <img src="img/products/n5.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
            <div class="pro">
                <img src="img/products/n6.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
            <div class="pro">
                <img src="img/products/n7.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
            <div class="pro">
                <img src="img/products/n8.jpg" alt="">
                <div class="des">
                    <span>adidas</span>
                    <h5>Cartoon Astronaut T-Shiirts</h5>
                    <div class="star">
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                        <i class="ri-star-fill"></i>
                    </div>
                    <h4>$78</h4>
                </div>
                <a href="#"><i class="ri-shopping-cart-2-line cart"></i></a>
            </div>
        </div>
    </section>

    <section id="sm-banner" class="section-p1">
        <div class="banner-box">
            <h4>crazy deals</h4>
            <h2>buy 1 get 1 free</h2>
            <span>The best classic dress is on sale at cara</span>
            <button class="white">Learn More</button>
        </div>
        <div class="banner-box banner-box2">
            <h4>spring/summer</h4>
            <h2>upcoming season</h2>
            <span>The best classic dress is on sale at cara</span>
            <button class="white">Collection</button>
        </div>
    </section>

    <section id="banner3">
        <div class="banner-box">
            <h2>SEASONAL SALE</h2>
            <h3>Winter Collection -50% OFF</h3>
        </div>
        <div class="banner-box banner-box2">
            <h2>NEW FOOTWEAR COLLECTION</h2>
            <h3>Spring / Summer 2024</h3>
        </div>
        <div class="banner-box banner-box3">
            <h2>T-SHIRTS</h2>
            <h3>New Trendy Prints</h3>
        </div>
    </section>

    <section id="newsletter" class="section-p1 section-m1">
        <div class="newstext">
            <h4>Sign Up For Newsletters</h4>
            <p>Get E-mail updates about our latest shop and <span>special offers.</span></p>
        </div>
        <div class="form">
            <input type="text" placeholder="Your email address">
            <button class="normal">Sign Up</button>
        </div>
    </section> *@
@section scripts {
        <script>
            //
            $(document).ready(function() {
                var selectedCategoryId = null;
                var selectedBrandId = null;
                var pageNumber = 2;
                var pageSize = 20;
                var isLoading = false;
                var hasMoreData = true; // flag to stop future calls once empty response received

                // Initialize cart UI
                var cart = JSON.parse(localStorage.getItem('cart')) || [];
                if (cart.length === 0 || $("#cartNum").length == 0) {
                    $("#cartNum")[0].innerHTML = 0;
                    $("#cartNum1")[0].innerHTML = 0;
                } else {
                    $("#cartNum")[0].innerHTML = cart.length;
                    $("#cartNum1")[0].innerHTML = cart.length;
                }

                // Category filter
               $('.category-dropdown').on('click', function () {
                selectedCategoryId = $(this).data('value') || null; // save it
                var categoryName = $(this).text();
                $('#productSpecified').text(categoryName);

                $('#loader').show();
                $.ajax({
                    url: '/Home/GetProductsByCategory',
                    type: 'GET',
                    data: { categoryId: selectedCategoryId },
                    success: function (data) {
                        $('#loader').hide();
                        $('#pro-container').html(data);
                        pageNumber = 2;
                        hasMoreData = true;
                    }
                });
                // $.ajax({
                //     url: '/Home/GetBrandsByCategory',
                //     type: 'GET',
                //     data: { categoryId: selectedCategoryId },
                //     success: function (data) {
                //         debugger;
                //         $('#loader').hide();
                //         $('#pro-container').html(data);
                //         pageNumber = 2;
                //         hasMoreData = true;
                //     }
                // });
            });
              const categoryData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.CategoryVMs));

  $('.category-scroll').on('click', '.category-box', function () {
    const categoryId = $(this).data('category-id');
    const $this = $(this);

    // Highlight selected category
    $('.category-box').removeClass('active');
    $this.addClass('active');

    // 🟩 Reset pagination when category changes
    pageNumber = 2;
    hasMoreData = true;
    selectedCategoryId = categoryId;
    selectedBrandId = null; // reset brand too when changing category
    $('#pro-container').html(''); // clear products

    // Get the brands
    const category = categoryData.find(c => c.Id === categoryId);
    const brands = category?.BrandVMs || [];

    const $brandContainer = $('#brand-container');
    $brandContainer.empty();

    if (brands.length > 0) {
        brands.forEach(b => {
            $brandContainer.append(`
                <div class="brand-card" data-brand-id="${b.Id}">
                    ${b.DisplayBrandName}
                </div>
            `);
        });
    } else {
        // $brandContainer.html('<p class="placeholder-text">No brands in this category</p>');
    }

    // 🟢 Add this block to fetch products by category
    $('#loader').show();
    $.ajax({
        url: '/Home/GetProductsByCategory',
        type: 'GET',
        data: { categoryId: selectedCategoryId },
        success: function (data) {
            $('#loader').hide();
            $('#pro-container').html(data);
        },
        error: function () {
            $('#loader').hide();
            _SWAL.alertWithoutNotification('Error loading products');
        }
    });
});

                            // Handle brand clicks
            $('#brand-container').on('click', '.brand-card', function () {
                const brandId = $(this).data('brand-id');
                selectedBrandId = brandId;
                const $brand = $(this);

                // Highlight the selected brand
                $('.brand-card').removeClass('active');
                $brand.addClass('active');
                  // 🟩 Reset pagination when brand changes
                 pageNumber = 2;
                 hasMoreData = true;
                 $('#pro-container').html(''); // clear products
                // Find the currently active category
                const categoryId = $('.category-box.active').data('category-id');
                if (!categoryId) return;

                $('#loader').show();

                $.ajax({
                    url: '/Home/GetProductsByCategoryAndBrand',
                    type: 'GET',
                    data: { categoryId, brandId },
                    success: function (data) {
                        $('#loader').hide();
                        $('#pro-container').html(data);
                    },
                    error: function () {
                        $('#loader').hide();
                        _SWAL.alertWithoutNotification('Something went wrong while fetching products!');
                        // alert('Something went wrong while fetching products!');
                    }
                });
            });

            // Infinite scroll
            $(window).on('scroll', function () {
                if (!hasMoreData || isLoading) return;

                if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
                    loadMoreProducts();
                }
            });

            function loadMoreProducts() {
                debugger;
                if (!hasMoreData) return; // hard stop safeguard
                isLoading = true;

                var $url = "@Url.Action("GetPaginatedProducts", "Home")";
               var parameter = {
                pageNumber: pageNumber,
                pageSize: pageSize,
                categoryId: selectedCategoryId, // send current category
                brandId: selectedBrandId
                    };

                $('#loader').show();
                _Ajax.ReturnHTML($url, parameter, "GET", function () { },
                    function (data) {
                        $('#loader').hide();

                        if (!data || data.trim() === "") {
                            hasMoreData = false;      // stop any further attempts
                            isLoading = false;
                            return;
                        }

                        pageNumber++;
                        $('#pro-container').append(data);
                        isLoading = false;
                    },
                    function (xhr) {
                        $('#loader').hide();
                        isLoading = false;
                        hasMoreData = false; // stop retrying on error
                        _SWAL.AlertWithoutNotification("Something went wrong..!!");
                    });
            }

            $('#exploreMore').on('click', function () {
                var $url = "@Url.Action("GetPaginatedProducts", "Home")";
                var parameter = {
                    pageNumber: pageNumber,
                    pageSize: pageSize,
                    categoryId:selectedCategoryId,
                    brandId: selectedBrandId
                };

                $('#loader').show();

                _Ajax.ReturnHTML($url, parameter, "GET", function () { },
                    function (data) {
                        $('#loader').hide();

                        if (!data || data.trim() === "") {
                            // No more products
                            $('#exploreMore').prop("disabled", true).text("No More Products");
                            return;
                        }

                        pageNumber++;
                        $('#pro-container').append(data);
                    },
                    function (xhr) {
                        $('#loader').hide();
                        _SWAL.AlertWithoutNotification("Something went wrong..!!");
                    });
            });

            });
        </script>
        <script>
            function toggleChat() {
                const chat = document.getElementById("chat-box");
                chat.style.display = (chat.style.display === "flex") ? "none" : "flex";
            }

             function sendMessage() {
                const input = document.getElementById("chat-input");
                if (input.value.trim() === "") return;

                const phoneNumber = "201063181497"; // your WhatsApp number (without +)
                const message = encodeURIComponent(input.value);

                // Redirect to WhatsApp
                window.open(`https://wa.me/${phoneNumber}?text=${message}`, "_blank");

                // Clear input
                input.value = "";
            }
        </script>


}
