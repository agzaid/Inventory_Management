@{
    var currentAction = ViewContext.RouteData.Values["action"] as string;
    var currentController = ViewContext.RouteData.Values["controller"] as string;
}
@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();

    var cultureItems = LocalizationOptions.Value.SupportedUICultures
    .Select(c => new SelectListItem { Value = c.Name, Text = c.Name })
    .ToList();

    var returnUrl = string.IsNullOrEmpty(Context.Request.Path)
    ? "~/"
    : $"~{Context.Request.Path.Value}{Context.Request.QueryString}";
}
@{
    // 1. Get the current culture name (e.g., "en-US", "ar-EG")
    var currentCultureName = requestCulture.RequestCulture.UICulture.Name;

    // 2. Define the target language and the display name for the button
    string targetCultureName = "";
    string targetDisplayName = "";

    // Assuming you primarily support English ("en") and Arabic ("ar")
    if (currentCultureName.StartsWith("en", StringComparison.OrdinalIgnoreCase))
    {
        targetCultureName = LocalizationOptions.Value.SupportedUICultures
        .FirstOrDefault(c => c.Name.StartsWith("ar", StringComparison.OrdinalIgnoreCase))?.Name;
        targetDisplayName = "العربيه";
    }
    else if (currentCultureName.StartsWith("ar", StringComparison.OrdinalIgnoreCase))
    {
        targetCultureName = LocalizationOptions.Value.SupportedUICultures
        .FirstOrDefault(c => c.Name.StartsWith("en", StringComparison.OrdinalIgnoreCase))?.Name;
        targetDisplayName = "English";
    }
}

<style>
    /* Custom CSS for Modern Navbar */

    /* * Use a primary color for active links to make them pop.
     * (Replace #007bff with your brand color)
     */
    .active-link {
        color: var(--bs-primary, #007bff) !important; /* Use Bootstrap primary color or custom */
        font-weight: 600; /* Slightly bolder */
        border-bottom: 2px solid var(--bs-primary, #007bff); /* Subtle indicator */
        padding-bottom: 5px; /* Add padding to lift the text off the border */
    }

    /* Base Nav Link Style */
    .nav-link {
        color: #343a40 !important; /* Darker text for readability */
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
        transition: color 0.3s ease, border-bottom 0.3s ease; /* Smooth hover transition */
    }

        .nav-link:hover:not(.active-link) {
            color: var(--bs-secondary, #6c757d) !important; /* Subtle hover color */
        }

    /* Language Selector Cleanup */
    .language-selector-modern {
        background-color: transparent !important;
        padding: 0.25rem 0.5rem;
        font-size: 0.85rem;
        color: #343a40;
        cursor: pointer;
        border: 1px solid #ccc; /* Add a subtle border for a 'select' look */
        border-radius: 0.5rem; /* Soft rounded corners */
    }

    /* Cart Icon Badge Adjustment */
    .cart-icon-link .badge {
        /* Fine-tune position for the small number badge */
        transform: translate(25%, -25%); /* Moves it slightly down and right from the corner */
    }

    /* Mobile Toggler - Ensure the button is invisible but the icon is clear */
    .navbar-toggler:focus {
        box-shadow: none;
    }

    /* Optional: Add a subtle transition for the sticky bar */
    #main-navbar {
        transition: all 0.3s ease;
    }
</style>
<nav id="main-navbar" class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm py-2">
    <div class="container-fluid px-lg-5">
        <a class="navbar-brand" asp-action="index" asp-controller="Home">
            <img src="~/images/logo5.png" alt="Logo" style="height: 40px; width: auto;" />
        </a>

        <div class="d-flex align-items-center d-lg-none">

            <a class="nav-link cart-icon-link me-2" asp-action="Cart" asp-controller="Home" style="padding: 0;">
                <i class="ri-shopping-bag-line position-relative" style="font-size: 1.5rem; color: #343a40;">
                    <span id="cartNumMobile" class="badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle" style="font-size: .6em;"></span>
                </i>
            </a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="ri-menu-3-line" style="font-size: 1.5rem;"></span>
            </button>

        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">

                <li class="nav-item">
                    <a class="nav-link @(currentAction == "Index" && currentController == "Home" ? "active-link" : "")" asp-action="index" asp-controller="Home">@Localizer["Home"]</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(currentAction == "Shop" && currentController == "Home" ? "active-link" : "")" asp-action="Shop" asp-controller="Home">@Localizer["Shop"]</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(currentAction == "Contact" && currentController == "Home" ? "active-link" : "")" asp-action="Contact" asp-controller="Home">@Localizer["ContactUs"]</a>
                </li>

                <li class="nav-item ms-lg-3 me-lg-2 d-none d-lg-block">
                    <a class="nav-link cart-icon-link @(currentAction == "Cart" && currentController == "Home" ? "active-link" : "")" asp-action="Cart" asp-controller="Home">
                        <i class="ri-shopping-bag-line position-relative" style="font-size: 1.2rem;">
                            <span id="cartNum" class="badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle" style="font-size: .6em;"></span>
                        </i>
                    </a>
                </li>

                @{
                    // ... (Your Language Toggle Razor Logic remains here)
                }

                @if (!string.IsNullOrEmpty(targetCultureName))
                {
                    <li class="nav-item d-flex align-items-center me-lg-2">
                        <form asp-controller="Culture" asp-action="SetCulture" asp-route-returnUrl="@returnUrl" method="post" class="d-inline">
                            <input type="hidden" name="culture" value="@targetCultureName" />
                            <button type="submit" class="btn btn-outline-secondary btn-sm rounded-pill language-toggle-btn shadow-sm">
                                <i class="ri-global-line me-1"></i>
                                @targetDisplayName
                            </button>
                        </form>
                    </li>
                }

                <li class="nav-item d-flex align-items-center mt-2 mt-lg-0">
                    @* ... (Your Auth/Admin Buttons Logic remains here) ... *@
                    @if (User.Identity.IsAuthenticated)
                    {
                        @if (User.IsInRole("Admin"))
                        {
                            <a asp-controller="Home" asp-area="admin" asp-action="Index"
                               class="btn btn-warning btn-sm rounded-pill px-3 shadow-sm me-2">
                                <i class="ri-dashboard-line me-1"></i> Dashboard
                            </a>
                        }
                        <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                            <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill px-3 shadow-sm">
                                <i class="ri-logout-box-line me-1"></i> Logout
                            </button>
                        </form>
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" class="btn btn-primary btn-sm rounded-pill px-3 shadow-sm">
                            <i class="ri-login-box-line me-1"></i> Login
                        </a>
                    }
                </li>
            </ul>
        </div>
    </div>
</nav>
@section scripts {
    <script>
        $(document).ready(function() {
            // Note: Removed 'debugger;' for clean production code.

            var cart = JSON.parse(localStorage.getItem('cart')) || [];
            var cartCount = cart.length;

            // Use .text() or .html() to set the content of the badge
            // Select both the desktop badge (#cartNum) and the mobile badge (#cartNumMobile)
            if (cartCount > 0) {
                $("#cartNum, #cartNumMobile").text(cartCount);
                // Optionally show the badges only if there are items
                $("#cartNum, #cartNumMobile").show();
            } else {
                $("#cartNum, #cartNumMobile").text(0);
                // Optionally hide the badges if the count is zero
                // $("#cartNum, #cartNumMobile").hide();
            }

            // Your original code used .innerHTML which is not a jQuery function;
            // I've fixed it to use .text() for the cart count.

            // Note: If you want to use the original #cartNum1 ID from your very first request,
            // you would change #cartNumMobile to #cartNum1 here and in the HTML above.
        });
    </script>
}